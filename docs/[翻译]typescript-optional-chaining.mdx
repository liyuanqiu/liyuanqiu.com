---
name: ğŸ‘‰ Typescript Optional Chaining
menu: docs
route: /docs/typescript-optional-chaining
---

# Typescript Optional Chaining

> åŸæ–‡ä½œè€… Danielï¼Œå‘è¡¨äº 2019 å¹´ 10 æœˆ 1 æ—¥
>
> ç¿»è¯‘ï¼šæå…ƒç§‹
>
> åŸæ–‡åœ°å€ï¼šhttps://devblogs.microsoft.com/typescript/announcing-typescript-3-7-beta/

æˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒï¼ŒTypescript 3.7 Beta ç‰ˆæœ¬å·²ç»å‘å¸ƒäº†ã€‚è¿™æ˜¯ä¸€ä¸ªå…·æœ‰ Typescript 3.7 æ­£å¼ç‰ˆæœ¬æ‰€æœ‰ç‰¹æ€§çš„ç‰ˆæœ¬ã€‚è‡ªç°åœ¨èµ·åˆ° Typescript 3.7 æ­£å¼ç‰ˆæœ¬å‘å¸ƒï¼Œæˆ‘ä»¬å°†æŒç»­ä¿®å¤ç¼ºé™·ä»¥åŠè¿›ä¸€æ­¥æå‡æ€§èƒ½ä¸ç¨³å®šæ€§ã€‚

ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡ NuGet æˆ–ä¸‹é¢çš„ npm å‘½ä»¤æ¥å¼€å§‹ä½¿ç”¨è¯¥ Beta ç‰ˆæœ¬ï¼š

```bash
npm install typescript@beta
```

åŒæ—¶ï¼Œä½ å¯ä»¥ä»ä¸‹åˆ—èµ„æºä¸­è·å–å¯¹ä»£ç ç¼–è¾‘å™¨çš„æ”¯æŒï¼š

- [ä¸‹è½½é’ˆå¯¹ Visual Studio 2019/2017 çš„æ”¯æŒå·¥å…·](https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.typescript-37beta)
- è·ŸéšæŒ‡å¼•å®Œæˆå¯¹ [Visual Studio Code](https://code.visualstudio.com/Docs/languages/typescript#_using-newer-typescript-versions) åŠ [Sublime Text](https://github.com/Microsoft/TypeScript-Sublime-Plugin/#note-using-different-versions-of-typescript) çš„æ”¯æŒ

Typescript 3.7 Beta åŒ…å«äº†ä¸€äº›æˆ‘ä»¬æœ€æœŸå¾…çš„ç‰¹æ€§ï¼è®©æˆ‘ä»¬ä»æœ€é—ªäº®çš„ Typescript 3.7 çš„æ–°ç‰¹æ€§ï¼šOptional Chaining å¼€å§‹ï¼Œå¯¹è¿™ä¸ªå…¨æ–°çš„ç‰ˆæœ¬ä¸€æ¢ç©¶ç«Ÿã€‚

## Optional Chaining

Typescript 3.7 å®ç°äº†ä¸€ä¸ªè¿„ä»Šä¸ºæ­¢å‘¼å£°æœ€é«˜çš„ ECMAScript ç‰¹æ€§ï¼šoptional chaining! æˆ‘ä»¬çš„å›¢é˜Ÿæ·±åº¦å‚ä¸äº† TC39 æ ‡å‡†çš„åˆ¶å®šï¼Œæ¨åŠ¨è¯¥ç‰¹æ€§è¿›å…¥ Stage 3ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥å°†å…¶å¸¦ç»™æ‰€æœ‰ Typescript çš„ç”¨æˆ·ã€‚

é‚£ä¹ˆï¼Œoptional chaining åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»æ ¹æœ¬ä¸Šè®²ï¼Œoptional chaining æä¾›äº†ä¸€ç§ç¼–ç æ–¹å¼ï¼Œå¯ä»¥é¿å…æˆ‘ä»¬çš„è¡¨è¾¾å¼å› é‡åˆ° `null` æˆ– `undefined` è€Œåœæ­¢è¿è¡Œã€‚optional chaining çš„å…³é”®è¯æ˜¯ `?.` æ“ä½œç¬¦ï¼Œç”¨äºè®¿é—®å¯é€‰å±æ€§ã€‚çœ‹ä¸‹é¢è¿™è¡Œä»£ç ï¼š

```typescript
let x = foo?.bar.baz();
```

å½“ `foo` å·²ç»å®šä¹‰äº†ï¼Œ`foo.bar.baz()` å°†è¢«æ­£ç¡®æ‰§è¡Œï¼›å½“ `foo` æ˜¯ `null` æˆ– `undefined` æ—¶ï¼Œåœæ­¢æ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œå¹¶ç›´æ¥è¿”å› `undefined`ã€‚

ç›´ç™½åœ°è¯´ï¼Œä¸Šè¿°ä»£ç ç‰‡æ®µç›¸å½“äºä¸‹é¢çš„ä»£ç ï¼š

```typescript
let x = foo === null || foo === undefined ? undefined : foo.bar.baz();
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ `bar` æ˜¯ `null` æˆ– `undefined`ï¼Œæˆ‘ä»¬çš„ä»£ç åœ¨è®¿é—® `baz` æ—¶ä»å°†å‡ºé”™. åŒæ ·çš„ï¼Œå¦‚æœ `baz` æ˜¯ `null` æˆ– `undefined`ï¼Œæˆ‘ä»¬å°†åœ¨ call å®ƒæ—¶å‡ºé”™ã€‚`?.` ä»…ä»…æ£€æŸ¥å…¶å·¦ä¾§çš„å€¼æ˜¯å¦ä¸º `null` æˆ– `undefined`ï¼Œä¸ä¼šæ£€æŸ¥ä»»ä½•å³ä¾§çš„å±æ€§ã€‚

ä½ å°†ä¼šå‘ç°ï¼Œä½ å¯ä»¥ä½¿ç”¨ `?.` æ¥é‡å†™å¤§é‡æ›¾ç»ä½¿ç”¨ `&&` æ¥æ£€æŸ¥å±æ€§çš„ä»£ç ï¼š

```typescript
// Before
if (foo && foo.bar && foo.bar.baz) {
    // ...
}

// After-ish
if (foo?.bar?.baz) {
    // ...
}
```

è¯·è®°ä½ä¸€ç‚¹ï¼Œ`?.` ä¸ `&&` çš„è¡Œä¸ºå¹¶ä¸ä¸€è‡´ï¼Œå‰è€…åªæ£€æŸ¥ `null` æˆ– `undefined`ï¼Œè€Œåè€…ä¼šå¯¹æ‰€æœ‰â€œå‡å€¼â€ä½œå‡ºå“åº”ï¼ˆä¾‹å¦‚ç©ºå­—ç¬¦ä¸²ï¼Œ`0`ï¼Œ`NaN` ä»¥åŠ `false`ï¼‰ã€‚

Optional chaining è¿˜æœ‰å¦å¤–ä¸¤ç§æ“ä½œå®šä¹‰ã€‚ç¬¬ä¸€ç§ï¼Œå«åš _å¯é€‰å…ƒç´ è®¿é—®_ï¼Œå®ƒçš„è¡Œä¸ºä¸å¯é€‰å±æ€§è®¿é—®ç›¸ä¼¼ï¼Œä½†å…è®¸æˆ‘ä»¬è®¿é—®éæ ‡è¯†ç¬¦å±æ€§ï¼ˆä¾‹å¦‚ä»»æ„å­—ç¬¦ä¸²ã€æ•°å­—æˆ–æ˜¯ symbolsï¼‰ï¼š

```typescript
/**
 * Get the first element of the array if we have an array.
 * Otherwise return undefined.
 */
function tryGetFirstElement<T>(arr?: T[]) {
    return arr?.[0];
    // equivalent to
    //   return (arr === null || arr === undefined) ?
    //       undefined :
    //       arr[0];
}
```

å¦ä¸€ç§ï¼Œå«åš _å¯é€‰è°ƒç”¨_ï¼Œå®ƒå…è®¸æˆ‘ä»¬æœ‰æ¡ä»¶åœ°è°ƒç”¨è¡¨è¾¾å¼ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ä¸º `null` æˆ– `undefined`ï¼Œåˆ™è°ƒç”¨å®ƒï¼Œå¦åˆ™ä¸åšæ“ä½œï¼š

```typescript
async function makeRequest(url: string, log?: (msg: string) => void) {
    log?.(`Request started at ${new Date().toISOString()}`);
    // equivalent to
    //   if (log !== null && log !== undefined) {
    //       log(`Request started at ${new Date().toISOString()}`);
    //   }

    const result = (await fetch(url)).json();

    log?.(`Request finished at at ${new Date().toISOString()}`);

    return result;
}
```

Optional chains çš„è¡Œä¸ºä»…é™äº "æ™®é€š" ä»¥åŠå¯é€‰å±æ€§è®¿é—®ã€å¯é€‰è°ƒç”¨ä»¥åŠå¯é€‰å…ƒç´ è®¿é—®ã€‚å®ƒä¸ä¼šä»è¿™äº›è¡¨è¾¾å¼è¿›ä¸€æ­¥æ‰©å±•ã€‚æ¢å¥è¯è¯´ï¼š

```typescript
let result = foo?.bar / someComputation()
```

ä¸ä¼šé˜»æ­¢é™¤æ³•æ“ä½œä»¥åŠ `someComputation()` çš„è°ƒç”¨ã€‚å®ƒç­‰ä»·äºï¼š

```typescript
let temp = foo === null || foo === undefined ? undefined : foo.bar;

let result = temp / someComputation();
```

è¿™å°†ä¼šå¯¼è‡´è¢«é™¤æ•°ä¸º `undefined`ï¼Œå› æ­¤ï¼Œå½“æˆ‘ä»¬å¼€å¯äº† Typescript çš„ `strictNullChecks` æ ‡è®°æ—¶ï¼Œä¸‹åˆ—ä»£ç å°†ä¼šå‡ºé”™ï¼š

```typescript
function barPercentage(foo?: { bar: number }) {
    return foo?.bar / 100;
    //     ~~~~~~~~
    // Error: Object is possibly undefined.
}
```

ä½ å¯ä»¥ä» [read up on the proposal](https://github.com/tc39/proposal-optional-chaining/) ä»¥åŠ [view the original pull request](https://github.com/microsoft/TypeScript/pull/33294) è·å–æ›´å¤šä¿¡æ¯ã€‚

## Nullish Coalescing

nullish coalescing æ“ä½œç¬¦æ˜¯å¦ä¸€ä¸ªå³å°†å’Œ optional chaining æ‰‹ç‰µæ‰‹ä¸€èµ·åˆ°æ¥çš„ ECMAScript ç‰¹æ€§ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å›¢é˜ŸæŒç»­è‡´åŠ›æ¨è¿›çš„æ–°ç‰¹æ€§ã€‚

è¯¥ç‰¹æ€§æä¾›äº†ä¸€ä¸ªæ–°çš„æ“ä½œç¬¦ï¼š`??`ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ç§å¤„ç† `null` æˆ– `undefined` æ—¶çš„é»˜è®¤å€¼â€œå›é€€â€ã€‚çœ‹è¿™æ®µä»£ç ï¼š

```typescript
let x = foo ?? bar();
```

è¿™æ˜¯ä¸€ç§æ–°çš„æ–¹å¼ï¼Œæ¥è¡¨è¾¾ï¼š

> å½“ `foo` å­˜åœ¨å€¼æ—¶ï¼Œä½¿ç”¨å®ƒçš„å€¼ï¼Œè‹¥å®ƒæ˜¯ `null` æˆ– `undefined` æ—¶ï¼Œè®¡ç®— `bar()` æ¥å–ä»£å®ƒ

ç›¸åº”åœ°ï¼Œä¸Šè¿°ä»£ç ç­‰ä»·äºä¸‹åˆ—ä»£ç ï¼š

```typescript
let x = foo !== null && foo !== undefined ? foo : bar();
```

`??` æ“ä½œç¬¦å¯ä»¥æ›¿ä»£è¿‡å»ä¸ºäº†å°è¯•é»˜è®¤å€¼è€Œä½¿ç”¨ `||` çš„ç”¨æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢è¿™æ®µä»£ç ç‰‡æ®µå°è¯•ä» [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ä¸­è¯»å–ä¸Šæ¬¡å­˜å‚¨çš„å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼›ç„¶è€Œï¼Œå› ä¸ºä½¿ç”¨äº† `||`ï¼Œå®ƒæ˜¯æœ‰ bug çš„ï¼š

```typescript
function initializeAudio() {
  let volume = localStorage.volume || 0.5;

  // ...
}
```

å½“ `localStorage.volume` è¢«è®¾æˆ `0` æ—¶ï¼Œvolume å˜é‡å°†è¢«è®¾æˆ `0.5`ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚`??` é¿å…äº†ä¸€äº›å› å‡å€¼ï¼ˆä¾‹å¦‚ `0`ï¼Œ`NaN` ä»¥åŠ `""`ï¼‰å¼•èµ·çš„ä¸€äº›é¢„æ–™ä¹‹å¤–çš„è¡Œä¸ºã€‚

æˆ‘ä»¬è¡·å¿ƒæ„Ÿè°¢ç¤¾åŒºçš„æˆå‘˜ [Wenlu Wang](https://github.com/Kingwl) ä»¥åŠ [Titian Cernicova Dragomir](https://github.com/dragomirtitian) å®ç°äº†è¿™ä¸ªç‰¹æ€§ï¼ä½ å¯ä»¥ä» [check out their pull request](https://github.com/microsoft/TypeScript/pull/32883) ä»¥åŠ [the nullish coalescing proposal repository](https://github.com/tc39/proposal-nullish-coalescing/) è·å–æ›´å¤šä¿¡æ¯ã€‚
